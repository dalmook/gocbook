<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GOC 도서관</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">📚</div>
      <div>
        <div class="title" id="libNameTitle">GOC 도서관</div>
        <div class="subtitle">도서 대장 · 대여/반납 · ISBN 자동등록</div>
      </div>
    </div>

    <div class="top-actions">
      <button class="btn btn-ghost" id="lockBtn" title="관리자 잠금/해제">🔒 잠금</button>
    </div>
  </header>

  <nav class="tabs" aria-label="메뉴">
    <button class="tab is-active" data-page="dashboard">대시보드</button>
    <button class="tab" data-page="add">도서 등록</button>
    <button class="tab" data-page="books">보유 도서</button>
    <button class="tab" data-page="loans">대여 현황</button>
    <button class="tab" data-page="settings">설정</button>
  </nav>

  <main class="container">
    <!-- DASHBOARD -->
    <section class="page is-active" id="page-dashboard">
      <div class="grid-3">
        <div class="card">
          <div class="card-h">총 보유</div>
          <div class="metric" id="mTotal">0</div>
          <div class="muted">등록된 도서(권) 수</div>
        </div>
        <div class="card">
          <div class="card-h">비치중</div>
          <div class="metric" id="mAvail">0</div>
          <div class="muted">대여 가능한 도서</div>
        </div>
        <div class="card">
          <div class="card-h">대여중 / 연체</div>
          <div class="metric"><span id="mLoaned">0</span> / <span class="danger" id="mOverdue">0</span></div>
          <div class="muted">반납예정일 지난 건은 연체</div>
        </div>
      </div>

      <div class="card mt-16">
        <div class="row between center">
          <h2 class="h2">연체/임박 대여</h2>
          <div class="muted">오늘 기준 D-3 이내 + 연체</div>
        </div>
        <div id="dueSoonList" class="list"></div>
        <div class="empty" id="dueSoonEmpty">표시할 대여가 없어요.</div>
      </div>

      <div class="card mt-16">
        <div class="row between center">
          <h2 class="h2">최근 활동</h2>
          <div class="muted">대여/반납/등록 기록</div>
        </div>
        <div id="activityList" class="list"></div>
        <div class="empty" id="activityEmpty">아직 기록이 없어요.</div>
      </div>
    </section>

    <!-- ADD BOOK -->
    <section class="page" id="page-add">
      <div class="card">
        <h2 class="h2">도서 등록</h2>
        <p class="muted">
          ISBN(바코드) 또는 키워드로 검색하면 표지/제목/저자 정보를 자동으로 가져와요.
        </p>

        <div class="form-row mt-12">
          <div class="field">
            <label>검색어 (ISBN 또는 제목/저자)</label>
            <input id="q" type="text" placeholder="예: 9788932473901 또는 '클린 코드'" />
          </div>
          <div class="field">
            <label>권수(복수 등록)</label>
            <input id="copyCount" type="number" min="1" value="1" />
          </div>
          <div class="field">
            <label>&nbsp;</label>
            <button class="btn" id="searchBtn">검색</button>
          </div>
        </div>

        <div class="row gap-8 mt-12 wrap">
          <button class="btn btn-ghost" id="manualAddBtn">✍️ 수동 입력으로 등록</button>
          <div class="pill" id="apiHint">Open API: Google Books + Open Library</div>
          <div class="pill" id="adminHint">🔒 잠금 상태에서는 등록/수정이 제한돼요</div>
        </div>

        <div class="mt-16">
          <h3 class="h3">검색 결과</h3>
          <div id="searchResults" class="grid-cards mt-8"></div>
          <div class="empty" id="searchEmpty">검색어를 입력하고 검색을 눌러주세요.</div>
        </div>
      </div>
    </section>

    <!-- BOOKS -->
    <section class="page" id="page-books">
      <div class="card">
        <div class="row between center">
          <h2 class="h2">보유 도서</h2>
          <div class="row gap-8 wrap">
            <input id="bookSearch" class="input" type="text" placeholder="인벤번호/제목/저자/ISBN 검색" />
            <select id="bookFilter" class="input">
              <option value="all">전체</option>
              <option value="available">비치중</option>
              <option value="loaned">대여중</option>
              <option value="overdue">연체</option>
            </select>
            <div class="view-toggle">
              <button class="btn btn-ghost" id="viewGridBtn" type="button">그리드</button>
              <button class="btn btn-ghost" id="viewListBtn" type="button">리스트</button>
            </div>
          </div>
        </div>

        <div id="booksList" class="grid-cards mt-12"></div>
        <div class="empty" id="booksEmpty">등록된 도서가 없어요. “도서 등록”에서 추가해봐!</div>
      </div>
    </section>

    <!-- LOANS -->
    <section class="page" id="page-loans">
      <div class="card">
        <div class="row between center">
          <h2 class="h2">대여 현황</h2>
          <input id="loanSearch" class="input" type="text" placeholder="대여자/인벤번호/제목 검색" />
        </div>

        <div class="table-wrap mt-12">
          <table class="table">
            <thead>
              <tr>
                <th>상태</th>
                <th>인벤번호</th>
                <th>도서</th>
                <th>대여자</th>
                <th>대여일</th>
                <th>반납예정</th>
                <th>액션</th>
              </tr>
            </thead>
            <tbody id="loanTbody"></tbody>
          </table>
        </div>
        <div class="empty" id="loansEmpty">대여중인 도서가 없어요.</div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section class="page" id="page-settings">
      <div class="card">
        <h2 class="h2">설정</h2>

        <div class="grid-2 mt-12">
          <div class="field">
            <label>도서관 이름</label>
            <input id="libName" type="text" placeholder="예: GOC 도서관" />
          </div>
          <div class="field">
            <label>기본 대여기간(일)</label>
            <input id="defaultLoanDays" type="number" min="1" value="14" />
          </div>
        </div>

        <div class="divider"></div>

        <div class="grid-2">
          <div class="field">
            <label>관리자 PIN (잠금 해제용)</label>
            <input id="pin" type="password" placeholder="예: 1234" inputmode="numeric" />
            <div class="muted">PIN은 브라우저에 해시로 저장돼요.</div>
          </div>
          <div class="field">
            <label>&nbsp;</label>
            <button class="btn" id="saveSettingsBtn">저장</button>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row between center wrap">
          <div>
            <div class="h3">데이터 초기화</div>
            <div class="muted">모든 도서/대여 기록이 삭제됩니다 (주의!).</div>
          </div>
          <button class="btn btn-danger" id="resetBtn">초기화</button>
        </div>
      </div>
    </section>
  </main>

  <!-- DIALOG: checkout/return/edit/manual add -->
  <dialog id="dlg">
    <form method="dialog" class="dlg">
      <div class="dlg-h">
        <div class="dlg-title" id="dlgTitle">작업</div>
        <button class="btn btn-ghost" value="cancel" aria-label="닫기">✕</button>
      </div>

      <div class="dlg-b" id="dlgBody"></div>

      <div class="dlg-f">
        <button class="btn btn-ghost" value="cancel">취소</button>
        <button class="btn" id="dlgOkBtn" value="ok">확인</button>
      </div>
    </form>
  </dialog>

  <div class="toast" id="toast"></div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="app.js"></script>
</body>
</html>
